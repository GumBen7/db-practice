---
title: Лабораторная работа 3
---

### Фильтрация данных, WHERE

Для фильтрации данных применяется оператор WHERE. Синтаксис: 

```sql
WHERE <условие>
```

В условиях поле таблицы сравнивается с константой или с выражением.
Символьные константы пишутся в одинарных кавычках.
Числовые константы и названия столбцов пишутся без кавычек.
Чтобы строка попала в результат, условие должно быть истинно.

---


### Операции сравнения

В условиях используются операции сравнения. В Transact-SQL применяются следующие операции сравнения:

= – равенство;
<> или != – неравенство;
\< – меньше;
\> – больше;
!< – не меньше;
!> – не больше;
<= – меньше или равно;
\>= – больше или равно.

При сравнении строк регистр не имеет значение. В качестве условия могут использоваться и сложные выражения.

---


### Логические операторы

Можно использовать несколько условий для фильтрации данных. Для объединения их
в одно выражение используются логические операторы. В Transact-SQL применяются следующие логические операторы:

* AND – логическое умножение или конъюнкция (И).
  Бинарный оператор, объединяет два условия; если оба условия истинны, результат – истина, иначе – ложь.
* OR – логическое сложение или дизъюнкция (ИЛИ).
  Бинарный оператор, объединяет два условия; если хотя бы одно из этих условий истинно, то общее условие оператора OR
  также будет истинно.
* NOT – логическое отрицание или инверсия (НЕ).
  Унарный оператор, применяется к одному условию. Если выражение в этой операции ложно, то общее условие истинно.

Самый высокий приоритет у оператора NOT. Самый низкий – у OR.
Если эти операторы встречаются в одном выражении, то сначала выполняется NOT, потом AND, а затем OR.

При записи условий использование скобок – хороший тон программирования.

---


### Операторы фильтрации: BETWEEN, LiKE, NULL, IN и NOT IN

Оператор BETWEEN используется для сравнения с диапазоном от начального и до конечного значения.
Начальное и конечное значения включены в промежуток.

Если надо, наоборот, выбрать те строки, которые не попадают в данный диапазон, то применяется оператор NOT BETWEEN.

```sql
WHERE выражение [NOT] BETWEEN начальное_значение AND конечное_значение
```

Оператор LIKE используется для сравнения с шаблоном строки. Для определения шаблона применяются специальные символы:

!% – любая последовательность символов, в том числе пустая;
!_ – любой символ;
!\[ ] – символ, который указан в квадратных скобках;
!\[ - ] – символ из определенного диапазона;
!\[ ^ ] – символ, который не указан после символа ^.

```sql
WHERE выражение [NOT] LIKE шаблон_строки
```

В базах данных, для обозначения неизвестного значения, используется понятие NULL.

Для проверки неизвестного значения нельзя использовать операторы сравнения. Допускается только IS NULL или IS NOT NULL.

```sql
SELECT * FROM Products
WHERE ProductCount IS NULL
```

Оператор IN используется для сравнения с набором значений. Список значений указывается в скобках.
Этот набор может вычисляться динамически на основании, например, еще одного запроса, либо это могут быть константные значения.

С помощью оператора NOT можно найти все строки, которые, наоборот, не соответствуют набору значений

```sql
WHERE выражение [NOT] IN (выражение)
```

---


### Функции проверки значений

Список часто используемых:

* ISDATE(выражение) - возвращает 1, если выражение имеет допустимое значение типа даты и времени, иначе возвращает значение 0
* ISNUMERIC(выражение) - возвращает 1, если выражение имеет допустимое значение числовой тип данных, иначе возвращает 0
* ISNULL(выражение, замена) - заменяет значение NULL указанным замещающим значением COALESCE(выражение\[,...n ]),
  вычисляет аргументы по порядку и возвращает текущее значение первого выражения, изначально не вычисленного как NULL.

---


### Объединение однотипных запросов, UNION

Для объединения результатов двух или более запросов в одну таблицу используется команда UNION.
Команда UNION объединяет вывод двух или более запросов в единый набор 
строк и столбцов и имеет вид:

```sql
SELECT_выражение1
UNION [ALL] SELECT_выражение2
[UNION [ALL] SELECT_выражениеN]
```

Для объединения результатов нескольких запросов с помощью UNION, они должны соответствовать следующим требованиям:
* содержать одинаковое количество столбцов;
* типы данных столбцов должны совпадать во всех запросах;
* в промежуточных запросах нельзя использовать сортировку ORDER BY.

Чтобы отсортировать результат объединения, в конце запроса добавляется ORDER BY.
Названия столбцов в запросах могут отличаться. Поэтому в команде ORDER BY указывается название столбцов с первого запроса.
Если объединяемые наборы содержат в строках идентичные значения, то при объединении повторяющиеся строки удаляются.
Если необходимо при объединении сохранить повторяющиеся строки, то для этого используется параметр ALL.

Все запросы выполняются независимо друг от друга, а уже их вывод объединяется.
В объединяемых запросах можно использовать одну и ту же таблицу.

---


### Разность двух выборок, EXCEPT

Чтобы найти разность двух выборок, то есть те строки, которые есть в первой выборке, но которых нет во второй, 
используется команда EXCEPT. Она имеет следующий вид:

```sql 
SELECT_выражение1
EXCEPT SELECT_выражение2
```

Возвращаются все различные значения, указанные слева от оператора EXCEPT.
Эти значения возвращаются, если они отсутствуют в результатах выполнения правого запроса.
Требования к использованию команды EXCEPT такие же, как к команде UNION.
Если сравниваются значения столбцов с целью определения различных строк, два значения NULL считаются равными.

### Общее в двух выборках, INTERSECT

Команда INTERSECT позволяет найти общие строки в результатах двух запросов, 
то есть данный оператор выполняет операцию пересечения множеств. Команда INTERSECT имеет следующий вид:

```sql 
SELECT_выражение1
INTERSECT SELECT_выражение2
```

Требования к использованию команды INTERSECT такие же, как к командам UNION и EXCEPT.

---


### 12 заданий по таблице со странами

1. Вывести названия и столицы пяти наибольших стран по площади.
2. Вывести список африканских стран, население которых не превышает 1 млн. чел.
3. Вывести список стран, население которых больше 5 млн. чел., а площадь меньше
   100 тыс. кв. км, и они расположены не в Европе.
4. Вывести список стран Северной и Южной Америки, население которых больше
   20 млн. чел., или стран Африки, у которых население больше 30 млн. чел.
5. Вывести список стран, население которых составляет от 10 до 100 млн. чел., а площадь не больше 500 тыс. кв. км.
6. Вывести список стран, названия которых не начинаются с буквы «К».
7. Вывести список стран, в названии которых третья буква – «а», а предпоследняя – «и».
8. Вывести список стран, в названии которых вторая буква – гласная.
9. Вывести список стран, названия которых начинаются с букв от «К» до «П».
10. Вывести список стран, названия которых начинаются с букв от «А» до «Г», но не с буквы «Б».
11. Вывести список стран, столицы которых есть в базе.
12. Вывести список стран Африки, Северной и Южной Америки.

---

### Задания по объединению однотипных запросов

1. Вывести объединенный результат выполнения запросов, которые выбирают страны с площадью меньше 500 кв. км и с площадью больше 5 млн. кв. км.
2. Вывести список стран с площадью больше 1 млн. кв. км, исключить страны с населением меньше 100 млн. чел.
3. Вывести список стран с площадью меньше 500 кв. км и с населением меньше 100 тыс. чел.

---

### Задания для своих таблиц

---

[Таблица стран](assets/lab3/Страны.xlsx)

[К списку лабораторных >>>](../README.md)
